 ### Pdf Service



1. –ë–∞–∑–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏: –¥–æ–∫—É–º–µ–Ω—Ç, —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –±–æ–∫—Å—ã
–ö–ª–∞—Å—Å—ã:
PDDocument
PDPage
PDRectangle (mediaBox, cropBox –∏ —Ç.–ø.)
Loader.loadPDF(...)

–ß—Ç–æ –ø–æ–Ω–∏–º–∞—Ç—å:
–∫–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å PDF –∏–∑ File / InputStream / ByteArray;
–∫–∞–∫ –ø—Ä–æ–π—Ç–∏—Å—å –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º;
–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –¥–æ–±–∞–≤–∏—Ç—å –µ—ë –≤ –¥–æ–∫—É–º–µ–Ω—Ç;
—á—Ç–æ —Ç–∞–∫–æ–µ mediaBox.width / height ‚Äî —Ä–∞–∑–º–µ—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –ø–æ–∏–Ω—Ç–∞—Ö (A4 ‚âà 595√ó842 pt);
—á—Ç–æ lowerLeftX/Y, upperRightX/Y ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥—Ä–∞–Ω–∏—Ü.

üëâ –≠—Ç–æ –±–∞–∑–∞, –±–µ–∑ –Ω–µ—ë –Ω–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å, –Ω–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å ¬´–≤–ª–µ–∑–∞–µ—Ç –ª–∏ —à—Ç–∞–º–ø¬ª.

2. –°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è

–≠—Ç–æ —Ç–æ, —á—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—Ç—Ä–µ–ª—è–µ—Ç –≤ –Ω–æ–≥—É üôÇ
–ß—Ç–æ –Ω—É–∂–Ω–æ —á—ë—Ç–∫–æ –¥–µ—Ä–∂–∞—Ç—å –≤ –≥–æ–ª–æ–≤–µ:
–í PDF (–∏ PDPageContentStream) —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:
(0, 0) ‚Äî –≤ –ª–µ–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã;
Y ‚Üë –≤–≤–µ—Ä—Ö, X ‚Üí –≤–ø—Ä–∞–≤–æ;
–µ–¥–∏–Ω–∏—Ü—ã ‚Äî –ø–æ–∏–Ω—Ç—ã (1 pt = 1/72 –¥—é–π–º–∞).
–ö–æ–≥–¥–∞ –º—ã —Ä–µ–Ω–¥–µ—Ä–∏–º –≤ PNG:
–ø–æ–ª—É—á–∞–µ–º –ø–∏–∫—Å–µ–ª–∏;
–ø—Ä–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ–º DPI –ø–µ—Ä–µ–≤–æ–¥:
pt = px * 72 / dpi.
PDFTextStripper.yDirAdj ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ, –≥–¥–µ:
(0, 0) ‚Äî –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É;
Y –∏–¥—ë—Ç –≤–Ω–∏–∑;
–ø–æ—ç—Ç–æ–º—É —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å pdf-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É:
pdfY = pageHeight - yDirAdj.

–ï—Å–ª–∏ —Ç—ã —ç—Ç–æ –ø–æ–Ω–∏–º–∞–µ—à—å –Ω–∞ —É—Ä–æ–≤–Ω–µ ¬´–º–æ–≥—É –Ω–∞ –±—É–º–∞–∂–∫–µ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –æ—Å–∏ –∏ –ø–æ—Å—á–∏—Ç–∞—Ç—å¬ª, 80% –º–∞–≥–∏–∏ –∏—Å—á–µ–∑–∞–µ—Ç.

3. –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: PDPageContentStream

–ö–ª–∞—Å—Å—ã:

PDPageContentStream
PDPageContentStream.AppendMode
PDImageXObject
(–¥–ª—è —Ç–µ–∫—Å—Ç–∞: PDFont, PDType0Font, PDType1Font, –Ω–æ —ç—Ç–æ –≤—Ç–æ—Ä–∏—á–Ω–æ)
–ß—Ç–æ –Ω—É–∂–Ω–æ —É–º–µ—Ç—å:
–æ—Ç–∫—Ä—ã—Ç—å 
PDPageContentStream –≤ —Ä–µ–∂–∏–º–µ AppendMode.APPEND, —á—Ç–æ–±—ã –Ω–µ —Å–Ω–µ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç;

–≤—ã–∑–≤–∞—Ç—å:
cs.drawImage(pdImage, x, y, width, height)

–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Å—á–∏—Ç–∞–≤ x, y, width, height –≤ –ø–æ–∏–Ω—Ç–∞—Ö;
–ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –µ—Å–ª–∏ —Ç—ã –Ω–∞—Ä–∏—Å—É–µ—à—å –∫–∞—Ä—Ç–∏–Ω–∫—É —Ç–∞–∫–∏—Ö –∂–µ —Ä–∞–∑–º–µ—Ä–æ–≤, –∫–∞–∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –≤ (0,0) ‚Äî —Ç—ã —Ä–µ–∞–ª—å–Ω–æ –∑–∞–∫—Ä–æ–µ—à—å –≤—Å—ë –ø–æ–¥ –Ω–µ–π.


4. –†–∞–±–æ—Ç–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏

–ö–ª–∞—Å—Å—ã:
PDImageXObject
createFromByteArray(doc, bytes, name)
createFromFileByContent(...)
(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) PDFRenderer + ImageType

–ß—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:
–∫–∞–∫ –∏–∑ ByteArray —Å–¥–µ–ª–∞—Ç—å PDImageXObject;
–∫–∞–∫ —É–∑–Ω–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
val wPx = image.width
val hPx = image.height

–∫–∞–∫ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è DPI:

–µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É –ø–æ–ª—É—á–∏–ª–∏ –∏–∑ PDFRenderer.renderImageWithDPI(page, dpi, ...),
—Ç–æ wPx –∏ hPx —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–∏ —ç—Ç–æ–º dpi;

—á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ¬´–Ω–∞—Ç–∏–≤–Ω—ã–µ¬ª —Ä–∞–∑–º–µ—Ä—ã –≤ –ø–æ–∏–Ω—Ç–∞—Ö:
wPt = wPx * 72 / dpi, hPt = hPx * 72 / dpi.

–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã:
–ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π —Ä–µ–∞–ª—å–Ω—ã–π ¬´—Ñ–∏–∑–∏—á–µ—Å–∫–∏–π¬ª —Ä–∞–∑–º–µ—Ä —à—Ç–∞–º–ø–∞ –≤ PDF;
—Ä–µ—à–∏—Ç—å, —Ä–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å –ª–∏ –µ–≥–æ, –∫–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å.


5. –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏ –µ–≥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: PDFTextStripper

–ö–ª–∞—Å—Å—ã:
PDFTextStripper
TextPosition

–ö–æ–Ω—Ü–µ–ø—Ü–∏–∏:
–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ PDFTextStripper –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å processTextPosition(text: TextPosition).

–ß—Ç–æ –µ—Å—Ç—å –≤ TextPosition:
xDirAdj, yDirAdj ‚Äî –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–≤ ¬´—ç–∫—Ä–∞–Ω–Ω—ã—Ö¬ª –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑);
—à–∏—Ä–∏–Ω–∞, –≤—ã—Å–æ—Ç–∞, baseline.

–ö–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–±–æ—Ç—É PDFTextStripper –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π:
startPage = pageIndex + 1
endPage = pageIndex + 1

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –º–∏–Ω–∏–º—É–º:
—Å–æ–±—Ä–∞—Ç—å minY/maxY (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç) –∏ —É–º–µ—Ç—å –∏—Ö –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ pdf-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã;
–ø–æ —ç—Ç–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –ø–æ–Ω—è—Ç—å, –≥–¥–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç ‚Üí –≥–¥–µ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å —à—Ç–∞–º–ø;
–æ—Å–æ–∑–Ω–∞–≤–∞—Ç—å, —á—Ç–æ —ç—Ç–æ –≤—Å–µ–≥–¥–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —Ö–∞–∫, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π layout –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º, –Ω–æ –¥–ª—è –Ω–∞—à–∏—Ö —Ü–µ–ª–µ–π –æ–±—ã—á–Ω–æ —Ö–≤–∞—Ç–∞–µ—Ç.

6. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ —Ç—ã –¥–µ–ª–∞–µ—à—å —à—Ç–∞–º–ø —á–µ—Ä–µ–∑ HTML ‚Üí PDF ‚Üí PNG)

–ö–ª–∞—Å—Å—ã:
PDFRenderer
ImageType
BufferedImage + ImageIO.write

–ß—Ç–æ –Ω–∞–¥–æ —É–º–µ—Ç—å:
–≤–∑—è—Ç—å PDDocument –∏ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É:
val renderer = PDFRenderer(doc)
val image = renderer.renderImageWithDPI(0, dpi, ImageType.ARGB)

–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–µ–∑–∞—Ç—å –ø–æ–ª—è –≤–æ–∫—Ä—É–≥ –ø–æ–ª–µ–∑–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:
–ø—Ä–æ–π—Ç–∏—Å—å –ø–æ –ø–∏–∫—Å–µ–ª—è–º BufferedImage;
–Ω–∞–π—Ç–∏ —Ä–∞–º–∫—É, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –ø–∏–∫—Å–µ–ª–∏ ¬´–Ω–µ —Ñ–æ–Ω¬ª;

–≤—ã–∑–≤–∞—Ç—å getSubimage(left, top, width, height).
–≠—Ç–æ –Ω—É–∂–Ω–æ –∫–∞–∫ —Ä–∞–∑ –¥–ª—è —Ç–≤–æ–µ–≥–æ –∫–µ–π—Å–∞: –∫–æ–≥–¥–∞ HTML ‚Üí PDF –¥–∞—ë—Ç ¬´—à—Ç–∞–º–ø –Ω–∞ —Ü–µ–ª–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ¬ª.


–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

–ï—Å–ª–∏ —Ç—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –∑–∞—Ö–æ—á–µ—à—å:
–¥–æ–±–∞–≤–ª—è—Ç—å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –ø–æ–¥–ø–∏—Å—å (PDSignature);
–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ PDF (COS* –∫–ª–∞—Å—Å—ã);
–∏–≥—Ä–∞—Ç—å—Å—è —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏/—Ñ–æ—Ä–º–∞–º–∏ (PDAnnotation, PDAcroForm),
—Ç–æ —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–æ–ª—å—à–∏–µ —Ç–µ–º—ã. –î–ª—è –∑–∞–¥–∞—á–∏ ¬´–≤–∫–ª–µ–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π —à—Ç–∞–º–ø¬ª –æ–Ω–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.

–ö–∞–∫ —è –±—ã —É—á–∏–ª—Å—è, –µ—Å–ª–∏ –±—ã –±—ã–ª –Ω–∞ —Ç–≤–æ—ë–º –º–µ—Å—Ç–µ

–ú–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç ‚Ññ1: ‚Äúhello, pdf‚Äù

–û—Ç–∫—Ä—ã—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π PDF.

–ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤ (50, 50) –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –∏ –º–∞–ª–µ–Ω—å–∫—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É.

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë –≤–∏–¥–Ω–æ –∏ –Ω–µ –ª–æ–º–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç.

–ú–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç ‚Ññ2: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

–ù–∞–ø–∏—Å–∞—Ç—å PDFTextStripper, –∫–æ—Ç–æ—Ä—ã–π:

–ø–µ—á–∞—Ç–∞–µ—Ç –≤ –ª–æ–≥ xDirAdj, yDirAdj –∏ —Ç–µ–∫—Å—Ç;

–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–µ—á–∞—Ç–∞–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–Ω–æ–µ pdfY = pageHeight - yDirAdj.

–ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –ø–æ–Ω—è—Ç—å, –≥–¥–µ —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∏/–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏.

–ú–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç ‚Ññ3: —É–º–Ω—ã–π —à—Ç–∞–º–ø

–í–∑—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç, –≤–Ω–∏–∑—É –∫–æ—Ç–æ—Ä–æ–≥–æ —É–∂–µ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç.

–ü–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º —Ç–µ–∫—Å—Ç–∞ –≤—ã—á–∏—Å–ª–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ.

–ï—Å–ª–∏ —Ö–≤–∞—Ç–∞–µ—Ç, —Ä–∏—Å–æ–≤–∞—Ç—å —à—Ç–∞–º–ø –ø–æ–¥ —Ç–µ–∫—Å—Ç–æ–º; –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –Ω–∞ –Ω–æ–≤–æ–º –ª–∏—Å—Ç–µ.

–ú–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç ‚Ññ4: HTML ‚Üí PDF ‚Üí PNG ‚Üí –æ–±—Ä–µ–∑–∫–∞ ‚Üí PDF

–¢–æ, —á—Ç–æ —Ç—ã —É–∂–µ –ø–æ—á—Ç–∏ —Å–¥–µ–ª–∞–ª:

HTML ‚Üí PDF;

PDF ‚Üí PNG;

PNG ‚Üí –æ–±—Ä–µ–∑–∫–∞;

PNG ‚Üí –≤—Å—Ç–∞–≤–∫–∞ –≤ –¥—Ä—É–≥–æ–π PDF.
